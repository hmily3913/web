<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
<TITLE>欢迎进入系统后台</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8" />
<link rel="stylesheet" href="../Images/CssAdmin.css">
<link rel="stylesheet" href="../Images/flexigrid.bbit.css">
<link rel="stylesheet" href="../Images/jquery.datepick.css">
<link rel="stylesheet" href="../Images/jqi.css">
<script language="javascript" src="../Script/Admin.js"></script>
<script language="javascript" src="../Script/jquery-1.5.2.min.js"></script>
<script language="javascript" src="../Script/flexigrid.pack.js"></script>
<script language="javascript" src="../Script/jquery.form.js"></script>
<script language="javascript" src="../Script/jquery.datepick.pack.js"></script>
<script language="javascript" src="../Script/jquery.datepick-zh-CN.js"></script>
<script language="javascript" src="../Script/jquery.easydrag.js"></script>
<script language="javascript" src="../Script/jquery-impromptu.3.1.js"></script>
<style type="text/css">
html{
margin:0;
padding:0;
background-color:#333;
font: 12px Arial, Helvetica, sans-serif;}
body{
margin:0 auto 0 auto;
padding:20px;
background-color:#eee;}
h1{margin-top:-10px;}
hr{margin:20px 0;}

</style>
</head>
<body>
<table id="flex1" style="display:none"></table>
<div id="listDiv" style="width:100%;height:100%;top:0;left:0;display:none;background-color:#888888;position:absolute;marginTop:-75px;marginLeft:-150px;overflow-y: hidden; overflow-x: hidden;z-index:500">
</div>
<script language="javascript">
$(function(){
	$('#addDiv').easydrag(); 
	$("#addDiv").setHandler("formove"); 
		$('#CtrlDate').datepick({dateFormat: 'yyyy-mm-dd'});
});
$("#flex1").flexigrid
	(
	{
	url: 'AllPersonalCtrlDetails.asp?showType=DetailsList',
	dataType: 'json',
	colModel : [
	{display: '单号', name : 'SerialNum', width : 40, sortable : true, align: 'left'},
	{display: '日期', name : 'CtrlDate', width : 60, sortable : true, align: 'left'},
	{display: '主单位', name : 'MainDepart', width : 60, sortable : true, align: 'left'},
	{display: '子单位', name:'SubDepart',width : 60, sortable : true, align: 'left'},
	{display: '应到', name : 'n1', width : 40, sortable : true, align: 'left'},
	{display: '新到', name : 'n2', width : 40, sortable : true, align: 'left'},
	{display: '离职', name : 'n3', width : 40, sortable : true, align: 'left'},
	{display: '旷工', name : 'n4', width : 40, sortable : true, align: 'left'},
	{display: '请假', name : 'n5', width : 40, sortable : true, align: 'left'},
	{display: '调入', name : 'n6', width : 40, sortable : true, align: 'left'},
	{display: '调出', name : 'n7', width : 40, sortable : true, align: 'left'},
	{display: '实到', name : 'n8', width : 40, sortable : true, align: 'left'},
	{display: '工作日', name : 'n9', width : 40, sortable : true, align: 'left'},
	{display: '审核', name : 'checkflag', width : 30, sortable : true, align: 'left'},
	{display: '备注', name : 'n10', width : 120, sortable : true, align: 'left'},
	{display: '制单人', name : 'n13', width : 50, sortable : true, align: 'left'},
	{display: '制单日期', name : 'n14', width : 120, sortable : true, align: 'left'},
	{display: 'Checker', name : 'h1', width : 30, hide:true},
	{display: 'CheckDate', name : 'h2', width : 30, hide:true},
	{display: '隐藏1', name : 'n15', width : 30, hide:true},
	{display: '隐藏2', name : 'n16', width : 30, hide:true},
	{display: '隐藏3', name : 'n17', width : 30, hide:true},
	{display: '隐藏4', name : 'n18', width : 30, hide:true},
	{display: '隐藏5', name : 'n19', width : 30, hide:true},
	{display: '隐藏6', name : 'n20', width : 30, hide:true}
		],
	buttons : [
		{name: '增加',  onpress : test},
		{separator: true},
		{name: '删除',  onpress : test},
		{separator: true},
		{name: '审核',  onpress : test},
		{separator: true},
		{name: '反审核',  onpress : test},
		{separator: true},
		{name: '汇总表',  onpress : test},
		{separator: true},
		{name: '明细表',  onpress : test},
		{separator: true}
		],
	searchitems : [
		{display: '日期', name : 'CtrlDate', isdefault: true},
		{display: '主单位', name : 'MainDepart'},
		{display: '子单位', name : 'SubDepart'},
		{display: '审核', name : 'checkflag'}
		],
	onRowDblclick:rowdbclick,
	sortname: "CtrlDate",
	sortorder: "desc",
//	singleSelect: true,
	striped:false,//
	rp: 20,
	usepager: true,
	title: '各部门人员出勤情况',
	showTableToggleBtn: true,
	width:'100%',
	height: 450
	}
	);
	
	function rowdbclick(rowData){
		$('#AddForm').resetForm();
		$('#TbDetails tr:gt(1)').remove();
		$('#CtrlDate').val($(rowData).data("CtrlDate"));
		$('#MainDepart').html("<option value='"+$(rowData).data("MainDepart")+"'>"+$(rowData).data("MainDepart")+"</option>");
		var tr=document.createElement('tr');
		var td = document.createElement('td');
		td.innerHTML='<input type="hidden" name="SerialNum" id="SerialNum" value="'+$(rowData).data("SerialNum")+'"><input type="text" class="textfield" style="width:100%" value="'+$(rowData).data("SubDepart")+'" name="'+NameArr[0].name+'" readonly>';
		$(tr).append(td);
		td=null;
		for(var n=1;n<$('#TbDetails tr:nth-child(2) td').length;n++){
			td = document.createElement('td');
			td.innerHTML='<input type="text" class="textfield" style="width:100%" value="'+$(rowData).data(("n"+n))+'" name="'+NameArr[n].name+'" '+(NameArr[n].setFlag==2?'readonly onFocus="return ShowManDiv(this,event)"':(NameArr[n].setFlag==1?'readonly':''))+'>';
			$(tr).append(td);
			td=null;
		}
			var hiddenfield='<input type="hidden" name="NewToMan" id="NewToMan" value="'+$(rowData).data(("n15"))+'">';
			hiddenfield+='<input type="hidden" name="LeftToMan" id="LeftToMan" value="'+$(rowData).data(("n16"))+'">';
			hiddenfield+='<input type="hidden" name="DesertToMan" id="DesertToMan" value="'+$(rowData).data(("n17"))+'">';
			hiddenfield+='<input type="hidden" name="LeaveToMan" id="LeaveToMan" value="'+$(rowData).data(("n18"))+'">';
			hiddenfield+='<input type="hidden" name="GetinToMan" id="GetinToMan" value="'+$(rowData).data(("n19"))+'">';
			hiddenfield+='<input type="hidden" name="OutToMan" id="OutToMan" value="'+$(rowData).data(("n20"))+'">';
			$(tr).append(hiddenfield);
		$('#TbDetails').append(tr);
		tr=null;
		$('#detailType').val('Edit');
		$("#addDiv").show("slow");
	}

	function test(com,grid)
	{
		if (com=='删除')
			{
				if($('.trSelected', grid).length==0){alert('请先选择一条记录再进行操作！');return false;}
				var AllSNum="";
				$('.trSelected', grid).each(function(i,fieldone){
					AllSNum=AllSNum+fieldone.id.replace("row","")+",";
				});
				AllSNum=AllSNum.substr(0,AllSNum.length-1);
				if (confirm('确定要删除单号为：' + AllSNum + ' 的记录?')){
				  $.post('AllPersonalCtrlDetails.asp?showType=DataProcess&detailType=Delete',{"SerialNum":AllSNum},function(data){
					if(data.indexOf("###")==-1) alert(data);
					else $("#flex1").flexReload();
				  });
				}
			}
		else if (com=='增加')
			{
				$('#AddForm').resetForm();
				$('#TbDetails tr:gt(1)').remove();
				$.get('AllPersonalCtrlDetails.asp?showType=getInfo&detailType=MainDepart', function(data) {
					var MainDeparts=jQuery.parseJSON(data);
					var optionStr="<option></option>";
					for(var n=0;n<MainDeparts.length;n++){
						optionStr+="<option value='"+MainDeparts[n]+"'>"+MainDeparts[n]+"</option>";
					}
					$('#MainDepart').html(optionStr);
				});
				var yestoday=showdate(0);
				$('#CtrlDate').val(yestoday);
				$('#detailType').val('AddNew');
				$("#addDiv").show("slow");
			}			
		else if (com=='审核')
			{
				if($('.trSelected', grid).length==0){alert('请先选择一条记录再进行操作！');return false;}
				var AllSNum="";
				$('.trSelected', grid).each(function(i,fieldone){
					AllSNum=AllSNum+fieldone.id.replace("row","")+",";
				});
				AllSNum=AllSNum.substr(0,AllSNum.length-1);
				if (confirm('确定要审核单号为：' + AllSNum + ' 的记录?')){
				  $.post('AllPersonalCtrlDetails.asp?showType=DataProcess&detailType=Check',{"SerialNum":AllSNum},function(data){
					if(data.indexOf("###")==-1) alert(data);
					else $("#flex1").flexReload();
				  });
				}
			}			
		else if (com=='反审核')
			{
				if($('.trSelected', grid).length==0){alert('请先选择一条记录再进行操作！');return false;}
				var AllSNum="";
				$('.trSelected', grid).each(function(i,fieldone){
					AllSNum=AllSNum+fieldone.id.replace("row","")+",";
				});
				AllSNum=AllSNum.substr(0,AllSNum.length-1);
				if (confirm('确定要审核单号为：' + AllSNum + ' 的记录?')){
				  $.post('AllPersonalCtrlDetails.asp?showType=DataProcess&detailType=UnCheck',{"SerialNum":AllSNum},function(data){
					if(data.indexOf("###")==-1) alert(data);
					else $("#flex1").flexReload();
				  });
				}
			}			
		else if (com=='汇总表')
			{
			var txt='请选择汇总表：<br>年份：<select id="FYear" name="FYear"><option value="2011">2011</option><option value="2012">2012</option><option value="2013">2013</option></select>';
				txt+='月份：<select id="FMonth" name="FMonth">';
				txt+='<option value="1">01</option>';
				txt+='<option value="2">02</option>';
				txt+='<option value="3">03</option>';
				txt+='<option value="4">04</option>';
				txt+='<option value="5">05</option>';
				txt+='<option value="6">06</option>';
				txt+='<option value="7">07</option>';
				txt+='<option value="8">08</option>';
				txt+='<option value="9">09</option>';
				txt+='<option value="10">10</option>';
				txt+='<option value="11">11</option>';
				txt+='<option value="12">12</option>';
				txt+='</select>';
				txt+='报表类型：<select id="RType" name="RType">';
				txt+='<option value="SumAll">公司总表</option>';
				txt+='<option value="M1">一分厂</option>';
				txt+='<option value="M2">二分厂</option>';
				txt+='<option value="M3">三分厂</option>';
				txt+='<option value="LQ">远华分厂</option>';
				txt+='<option value="YJ">眼镜布绳</option>';
				txt+='<option value="HSH">花生盒</option>';
				txt+='</select>';
				$.prompt(txt,{
					buttons: { 页面查看: 'weblook', 导出到Excel: 'outprint' },
					submit:function(v,m,f){ 
						if(v=='weblook'){
							$('#listDiv').load("AllPersonalCtrlDetails.asp #listtable",{
								showType:'getInfo',
								detailType:f.RType,
								FYear:f.FYear,
								FMonth:f.FMonth
							 },function(response, status, xhr){
								if (status =="success") {
									$("#listDiv").show("slow");
									$('#listDiv').easydrag(); 
									$("#listDiv").setHandler("formove2"); 
								}	
							});
							$.prompt.close();
						}else if(v=='outprint'){
							window.open("AllPersonalCtrlDetails.asp?print_tag=1&detailType="+f.RType+"&showType=getInfo&FMonth="+f.FMonth+"&FYear="+f.FYear,"Print","","false");
						}
						return false; 
					 }
				 });
			}			
		else if (com=='明细表')
			{
			var txt='请选择明细表：<br>年份：<select id="FYear" name="FYear"><option value="2011">2011</option><option value="2012">2012</option><option value="2013">2013</option></select>';
				txt+='月份：<select id="FMonth" name="FMonth">';
				txt+='<option value="1">01</option>';
				txt+='<option value="2">02</option>';
				txt+='<option value="3">03</option>';
				txt+='<option value="4">04</option>';
				txt+='<option value="5">05</option>';
				txt+='<option value="6">06</option>';
				txt+='<option value="7">07</option>';
				txt+='<option value="8">08</option>';
				txt+='<option value="9">09</option>';
				txt+='<option value="10">10</option>';
				txt+='<option value="11">11</option>';
				txt+='<option value="12">12</option>';
				txt+='</select>';
				$.prompt(txt,{
					buttons: { 页面查看: 'weblook', 导出到Excel: 'outprint' },
					submit:function(v,m,f){ 
						if(v=='weblook'){
							$('#listDiv').load("AllPersonalCtrlDetails.asp #listtable",{
								showType:'getInfo',
								detailType:'SumAllDetails',
								FYear:f.FYear,
								FMonth:f.FMonth
							 },function(response, status, xhr){
								if (status =="success") {
									$("#listDiv").show("slow");
									$('#listDiv').easydrag(); 
									$("#listDiv").setHandler("formove2"); 
								}	
							});
							$.prompt.close();
						}else if(v=='outprint'){
							window.open("AllPersonalCtrlDetails.asp?print_tag=1&detailType=SumAllDetails&showType=getInfo&FMonth="+f.FMonth+"&FYear="+f.FYear,"Print","","false");
						}
						return false; 
					 }
				 });
			}			
	}

function closead1(){
  $("#addDiv").hide("slow");
	$("#addDiv").css("z-index","500");
	closead();
}

function toSubmit(){
	if($('#MainDepart').val()==''||$('#CtrlDate').val()==''){alert('主单位和日期都不能为空!');return false;}
  $.post('AllPersonalCtrlDetails.asp?showType=DataProcess',$("#AddForm").serialize(),function(data){
		alert(data);
    if(data.indexOf("###")==-1) alert(data);
	else{
	  $("#addDiv").hide("slow");
		$("#addDiv").css("z-index","500");
	  $("#flex1").flexReload();
	}
  });
}
var NameArr=[{name:"SubDepart",value:"",setFlag:1},{name:"ShouldTo",value:0,setFlag:1},{name:"NewTo",value:0,setFlag:2},{name:"LeftTo",value:0,setFlag:2},{name:"DesertTo",value:0,setFlag:2},{name:"LeaveTo",value:0,setFlag:2},{name:"GetinTo",value:0,setFlag:2},{name:"OutTo",value:0,setFlag:2},{name:"RealTo",value:0,setFlag:1},{name:"WorkFlag",value:"是",setFlag:3},{name:"Remark",value:"",setFlag:3}];
function getSubDepart(){
	$.get('AllPersonalCtrlDetails.asp?showType=getInfo&detailType=SubDepart&UseLast='+$('#UseLast').val()+'&InfoID='+escape($('#MainDepart').val()) , function(data) {
		var SubDeparts=jQuery.parseJSON(data);
		$('#TbDetails tr:gt(1)').remove();
		for(var m=0;m<SubDeparts.length;m++){
			var tr=document.createElement('tr');
			for(var n=0;n<$('#TbDetails tr:nth-child(2) td').length;n++){
				var td = document.createElement('td');
				if(SubDeparts[m].subs[n]===undefined||SubDeparts[m].subs[n]=='')
					td.innerHTML='<input type="text" class="textfield" style="width:100%" value="'+(NameArr[n].name=="RealTo"?SubDeparts[m].subs[1]:NameArr[n].value)+'" name="'+NameArr[n].name+'" '+(NameArr[n].setFlag==2?'readonly onFocus="return ShowManDiv(this,event)"':(NameArr[n].setFlag==1?'readonly':''))+'>';
				else
					td.innerHTML='<input type="text" class="textfield" style="width:100%" value="'+SubDeparts[m].subs[n]+'" name="'+NameArr[n].name+'" '+(NameArr[n].setFlag==2?'readonly onFocus="return ShowManDiv(this,event)"':(NameArr[n].setFlag==1?'readonly':''))+'>';
				if(n==9)td.innerHTML='<input type="text" class="textfield" style="width:100%" value="'+(NameArr[n].name=="RealTo"?SubDeparts[m].subs[1]:NameArr[n].value)+'" name="'+NameArr[n].name+'" '+'onchange="setnoread(this)"'+'>';
				$(tr).append(td);
				td=null;
			}
				var hiddenfield='<input type="hidden" name="NewToMan" id="NewToMan">';
				hiddenfield+='<input type="hidden" name="LeftToMan" id="LeftToMan">';
				hiddenfield+='<input type="hidden" name="DesertToMan" id="DesertToMan" value="'+SubDeparts[m].subs[n]+'">';
				hiddenfield+='<input type="hidden" name="LeaveToMan" id="LeaveToMan" value="'+SubDeparts[m].subs[n+1]+'">';
				hiddenfield+='<input type="hidden" name="GetinToMan" id="GetinToMan">';
				hiddenfield+='<input type="hidden" name="OutToMan" id="OutToMan">';
				$(tr).append(hiddenfield);
			$('#TbDetails').append(tr);
			tr=null;
		}
	});
}
function setnoread(obj){
	if(obj.value=='是'){
		$('input').attr("readonly","readonly");
		$('[name=ShouldTo]',obj.parentNode.parentNode).unbind();
	}
	else{
		$('[name=ShouldTo]',obj.parentNode.parentNode).removeAttr("readonly");
		$('[name=ShouldTo]',obj.parentNode.parentNode).bind("change", function(){
			$('[name=RealTo]',obj.parentNode.parentNode).val(isNaN($('[name=ShouldTo]',obj.parentNode.parentNode).val()-$('[name=LeaveTo]',obj.parentNode.parentNode).val()-$('[name=DesertTo]',obj.parentNode.parentNode).val())?0:($('[name=ShouldTo]',obj.parentNode.parentNode).val()-$('[name=LeaveTo]',obj.parentNode.parentNode).val()-$('[name=DesertTo]',obj.parentNode.parentNode).val()));
		});
	}
}
//人员操作
var curField,trShould;
function ShowManDiv(obj,e){
	$("#ManDiv").show();
	curField=obj;
	trShould=isNaN(parseInt($('[name=ShouldTo]',obj.parentNode.parentNode).val())+parseInt($('[name=LeftTo]',obj.parentNode.parentNode).val())+parseInt($('[name=OutTo]',obj.parentNode.parentNode).val())-parseInt($('[name=LeaveTo]',obj.parentNode.parentNode).val())-parseInt($('[name=DesertTo]',obj.parentNode.parentNode).val())-parseInt($('[name=NewTo]',obj.parentNode.parentNode).val())-parseInt($('[name=GetinTo]',obj.parentNode.parentNode).val()))?0:(parseInt($('[name=ShouldTo]',obj.parentNode.parentNode).val())+parseInt($('[name=LeftTo]',obj.parentNode.parentNode).val())+parseInt($('[name=OutTo]',obj.parentNode.parentNode).val())-parseInt($('[name=LeaveTo]',obj.parentNode.parentNode).val())-parseInt($('[name=DesertTo]',obj.parentNode.parentNode).val())-parseInt($('[name=NewTo]',obj.parentNode.parentNode).val())-parseInt($('[name=GetinTo]',obj.parentNode.parentNode).val()));
	$('#ManDivTbDetails tr:gt(1)').remove();
	if($(('input[name='+obj.name+'Man]'),$(curField).parent().parent()).val().replace(/\s/g,"").length>0)
	$.get('AllPersonalCtrlDetails.asp?showType=getInfo&detailType=ShowPeson&InfoID='+escape($(('input[name='+obj.name+'Man]'),$(curField).parent().parent()).val().replace(/\s/g,"")) , function(data) {
		for(var m=0;m<$(('input[name='+obj.name+'Man]'),$(curField).parent().parent()).val().replace(/\s/g,"").split(';').length;m++){
			AddRow();
			$("input[name=PeronD]")[m+1].value=$(('input[name='+obj.name+'Man]'),$(curField).parent().parent()).val().replace(/\s/g,"").split(';')[m];
			if(data.length>0){
//				$("input[name=PeronDName]")[m+1].value=data.split(';')[m];
				for(var n=0;n<data.split(';').length;n++){
					if($("input[name=PeronD]")[m+1].value==data.split(';')[n].split('###')[1])$("input[name=PeronDName]")[m+1].value=data.split(';')[n].split('###')[0];
				}
			}
		}
	});
	$("#ManDiv").css({"top":e.clientY+"px", "left":e.clientX+"px", "visibility":"visible"});
}
function deleted(obj){
	obj.parentNode.parentNode.removeChild(obj.parentNode);
}
function AddRow(){
	var tbdetail=document.getElementById("ManDivTbDetails");
	var CloneNodeTr=tbdetail.rows[1].cloneNode(true);
	CloneNodeTr.style.display="block";
	tbdetail.appendChild(CloneNodeTr);
}

function closead(){
  $("#ManDiv").css("display",'none');
}
function SaveRow(){
  if($("input[name=PeronD]").length == 1){//没有外出人
    $(curField).val(0);
		$(('#'+curField.id+'Man'),$(curField).parent().parent()).val('')
  }else{//有外出人
    var o="",z=0;
    for(var n=1;n<$("input[name=PeronD]").length;n++){
	  if($("input[name=PeronD]")[n].value!=''){
	    if(o==""){
				o=$("input[name=PeronD]")[n].value;
			}
			else {
				o=o+";"+$("input[name=PeronD]")[n].value;
			}
			z+=1;
	  }
	}
    $(curField).val(z);
		$(('input[name='+curField.name+'Man]'),$(curField).parent().parent()).val(o);
  }
  $("#ManDiv").css("display",'none');
	cntPerson(curField);
}

function cntPerson(obj){
	if(obj.name=='LeaveTo'||obj.name=='DesertTo')$('[name=RealTo]',obj.parentNode.parentNode).val(isNaN($('[name=ShouldTo]',obj.parentNode.parentNode).val()-$('[name=LeaveTo]',obj.parentNode.parentNode).val()-$('[name=DesertTo]',obj.parentNode.parentNode).val())?0:($('[name=ShouldTo]',obj.parentNode.parentNode).val()-$('[name=LeaveTo]',obj.parentNode.parentNode).val()-$('[name=DesertTo]',obj.parentNode.parentNode).val()));
	else{
	$('[name=ShouldTo]',obj.parentNode.parentNode).val(isNaN(trShould-parseInt($('[name=LeftTo]',obj.parentNode.parentNode).val())-parseInt($('[name=OutTo]',obj.parentNode.parentNode).val())+parseInt($('[name=LeaveTo]',obj.parentNode.parentNode).val())+parseInt($('[name=DesertTo]',obj.parentNode.parentNode).val())+parseInt($('[name=NewTo]',obj.parentNode.parentNode).val())+parseInt($('[name=GetinTo]',obj.parentNode.parentNode).val()))?0:(trShould-parseInt($('[name=LeftTo]',obj.parentNode.parentNode).val())-parseInt($('[name=OutTo]',obj.parentNode.parentNode).val())+parseInt($('[name=LeaveTo]',obj.parentNode.parentNode).val())+parseInt($('[name=DesertTo]',obj.parentNode.parentNode).val())+parseInt($('[name=NewTo]',obj.parentNode.parentNode).val())+parseInt($('[name=GetinTo]',obj.parentNode.parentNode).val())));
	$('[name=RealTo]',obj.parentNode.parentNode).val(isNaN($('[name=ShouldTo]',obj.parentNode.parentNode).val()-$('[name=LeaveTo]',obj.parentNode.parentNode).val()-$('[name=DesertTo]',obj.parentNode.parentNode).val())?0:($('[name=ShouldTo]',obj.parentNode.parentNode).val()-$('[name=LeaveTo]',obj.parentNode.parentNode).val()-$('[name=DesertTo]',obj.parentNode.parentNode).val()));
	}
}

function getInfo(obj){
  if($(obj).val()==''||curField.name=='NewTo'){$('#ReplyTable input[type=button]').removeAttr("disabled");return false;}
	$('#ReplyTable input[type=button]').attr("disabled","disabled");
	$.get("AllPersonalCtrlDetails.asp", { showType: "getInfo",detailType: 'Peron', InfoID: $(obj).val() },
	   function(data){
		 if(data.indexOf("###")==-1){alert(data);$(obj).val('');}
		 else{
		 	$('#PeronD',obj.parentNode.parentNode).val(data.split('###')[0]);
		 	$('#PeronDName',obj.parentNode.parentNode).val(data.split('###')[1]);
		 }
		 $('#ReplyTable input[type=button]').removeAttr("disabled");
	   });
}
</script>
<div id="ManDiv" style="width:'202px';height:'200px';position:absolute;display:none;text-align:center;overflow:visible; z-index:9999">
<table id="ReplyTable" border="0" width="200px" cellspacing="0" cellpadding="1" align="center" bgcolor="black" height="100%">
<tbody id="ManDivTbDetails">
<tr style="background-color: #FFFFFF; background-repeat: repeat; background-attachment: scroll; border-right: 1px solid #000000; border-bottom: 1px solid #000000; background-position: 0%;border-bottom: 1px solid #000000;">
<td  bgcolor="#8DB5E9" height="24"  width="70">编号</td>
<td  bgcolor="#8DB5E9" height="24"  width="90">名称</td>
<td  bgcolor="#8DB5E9" width="40">操作</td>
</tr>
<tr height="24" id="CloneNodeTr" style='background-color: #FFFFFF; background-repeat: repeat; background-attachment: scroll; border-right: 1px solid #000000; border-bottom: 1px solid #000000; background-position: 0%;border-bottom: 1px solid #000000;cursor:hand; display:none'>
 <td >
 <input name="PeronD" type="text" class="textfield" style="WIDTH: 65;" id="PeronD" value="" onfocus="if(curField.name!='NewTo')$('#ReplyTable input[type=button][value=确定]').attr('disabled','disabled');" onblur="getInfo(this)"></td>
 <td >
		<input name="PeronDName" type="text" class="textfield" id="PeronDName" style="WIDTH: 88;" value="" maxlength="20" onfocus="if(curField.name!='NewTo')$('#ReplyTable input[type=button][value=确定]').attr('disabled','disabled');" onblur="getInfo(this)"></td>
 <td  align="right" onClick="deleted(this)"><img src="../images/close.jpg"/></td>
</tr>
</tbody>
<tr style="background-color: #FFFFFF; background-repeat: repeat; background-attachment: scroll; border-right: 1px solid #000000; border-bottom: 1px solid #000000; background-position: 0%;border-bottom: 1px solid #000000;">
<td valign="bottom" colspan="3" align="center">
&nbsp;<input style='HEIGHT: 18px;WIDTH: 40px;' name="submitSaveEdit" type="button" class="button"  id="submitSaveEdit" value="关闭"  onClick="closead()">
&nbsp;<input style='HEIGHT: 18px;WIDTH: 40px;' name="submitSaveEdit" type="button" class="button"  id="submitSaveEdit" value="增加"   onClick="AddRow()">
&nbsp;<input style='HEIGHT: 18px;WIDTH: 40px;' name="submitSaveEdit" type="button" class="button"  id="submitSaveEdit" value="确定"  onClick="SaveRow()">
</td>
</tr>
</tbody>
</table>
</div>
<div id="addDiv" style="width:96%;height:'420px';top:0;left:20;display:none;background-color:#888888;position:absolute;marginTop:-75px;marginLeft:-150px;overflow-y: hidden; overflow-x: hidden;z-index:500">
 <form id="AddForm" name="AddForm">
<table width="100%" border="0" cellpadding="3" cellspacing="1" bgcolor="#99BBE8">
  <tr>
    <td height="20" width="100%" class="tablemenu" id="formove"><font color="#15428B"><img src="../images/close.jpg" border="0" align="absmiddle" onClick="javascript:closead1()" >&nbsp;<strong>各部门人员出勤情况</strong></font></td>
  </tr>
  <tr>
    <td height="20" width="100%" bgcolor="#EBF2F9">
	  <table width="100%" border="0" cellpadding="0" cellspacing="0" id=editNews>
	<tbody id="TbDetails">
	<tr bgcolor="#99BBE8" >
	  <td align="left" colspan="11" class="toolbar">
		<select name="UseLast" id="UseLast"><option></option><option value="1">复制昨日</option></select>
		主单位：
		<select name="MainDepart" id="MainDepart" onchange="getSubDepart()"></select>&nbsp;日期：
		<input type="text" name="CtrlDate" id="CtrlDate" class="textfield" style="width:30%;" value=""/>
	  </td>
	</tr>
  <tr>
    <td width="80" bgcolor="#8DB5E9"><font color="#FFFFFF"><strong>子单位</strong></font></td>
    <td width="60" bgcolor="#8DB5E9"><font color="#FFFFFF"><strong>应到</strong></font></td>
    <td width="40" bgcolor="#8DB5E9"><font color="#FFFFFF"><strong>新到</strong></font></td>
    <td width="40" bgcolor="#8DB5E9"><font color="#FFFFFF"><strong>离职</strong></font></td>
    <td width="40" bgcolor="#8DB5E9"><font color="#FFFFFF"><strong>旷工</strong></font></td>
    <td width="40" bgcolor="#8DB5E9"><font color="#FFFFFF"><strong>请假</strong></font></td>
    <td width="40" bgcolor="#8DB5E9"><font color="#FFFFFF"><strong>调入</strong></font></td>
    <td width="40" bgcolor="#8DB5E9"><font color="#FFFFFF"><strong>调出</strong></font></td>
    <td width="60" bgcolor="#8DB5E9"><font color="#FFFFFF"><strong>实到</strong></font></td>
    <td width="60" bgcolor="#8DB5E9"><font color="#FFFFFF"><strong>工作日</strong></font></td>
    <td nowrap="nowrap" bgcolor="#8DB5E9"><font color="#FFFFFF"><strong>备注</strong></font></td>
  </tr>
	</tbody>
	<tr bgcolor="#99BBE8" >
	  <td align="center" colspan="11" class="toolbar">
	  <input type="hidden" name="detailType" id="detailType" value="">
			<input name="submitSaveAdd" type="button" class="button"  value="保存" style="WIDTH: 80;"  onClick="toSubmit(this)">&nbsp;
			<input type="button" class="button"  value="关闭" style="WIDTH: 80;"  onClick="closead1()">&nbsp;
	  </td>
	</tr>
	</table>
	</td>
  </tr>
</table>
</form>

</div>
</BODY>
</HTML>